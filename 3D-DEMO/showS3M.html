<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>模型展示</title>
    <link href="../Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <link href="./css/pretty.css" rel="stylesheet">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/tooltip.js"></script>
    <script type="text/javascript" src="./js/require.min.js" data-main="js/main"></script>
</head>

<body>
    <div id="cesiumContainer"></div>
    <div id='loadingbar' class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
    </div>
    <script type="text/javascript">
        function onload(Cesium) {
            //初始化viewer部件
            var viewer = new Cesium.Viewer('cesiumContainer');
            var scene = viewer.scene;
            var widget = viewer.cesiumWidget;
            $('#loadingbar').remove();
            try {
                // 相机视角
                scene.camera.setView({
                    destination: new Cesium.Cartesian3(-2172108.996759282, 4375350.277824589, 4101673.0066891187), //  看的高度 现在调低
                    orientation: {                  // -2171551.3227830417   4375506.2101590205
                        heading: 4.354565476048545,
                        pitch: -0.35245897259115955,
                        roll: 9.353513519272383e-10
                    }

                });

                // 将 s3m 文件位置信息（可放多个，后面循环读取）
                var s3mFilePath = [
                    './SampleData/models/testBim/KMLModels/GeoModel3D%23_515362609.s3m',
                    './SampleData/models/testBim/KMLModels/GeoModel3D%23_515435356.s3m',
                ];

                // 循环输出图层
                for (var i = 0; i < s3mFilePath.length; i++) {
                    var exam = s3mFilePath[i];
                    var keymap = {};
                    keymap[exam] = [];
                    var layer = new Cesium.DynamicLayer3D(scene._context, [exam]);
                    layer.updateInterval = 500;//动态图层更新时间
                    layer.enableLocalOffset = false;//禁止模型局部偏移
                    scene.primitives.add(layer);
                    var pillarState = new Cesium.DynamicObjectState({
                        id: i,
                        longitude: points[0],
                        latitude: points[1],
                        altitude: points[2],
                        scale: new Cesium.Cartesian3(1, 1, 1)
                    });
                    keymap[exam].push(pillarState);
                    for (var key in keymap) {
                        layer.updateObjectWithModel(key, keymap[key]);
                    };
                }
            } catch (e) {
                if (widget._showRenderLoopErrors) {
                    var title = '渲染时发生错误，已停止渲染。';
                    widget.showErrorPanel(title, undefined, e);
                }
            }
        }
    </script>

</body>

</html>